@model IEnumerable<Ticket_Train.Models.Train>
@using Ticket_Train.Models
<style>
    .train-list {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .train-item {
        border: 1px solid #ddd;
        padding: 15px;
        width: 250px;
    }

    .seats-section {
        margin-top: 10px;
    }

    .seats-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .seat {
        padding: 5px 10px;
        border: 1px solid #ddd;
        border-radius: 3px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

        .seat.available {
            background-color: #d4f0d4;
        }

        .seat.booked {
            background-color: #f0d4d4;
            cursor: not-allowed;
        }

        .seat.reserved {
            background-color: #d4d4f0;
            cursor: not-allowed;
        }

        .seat.selected {
            background-color: #ffd700;
        }

</style>

<head>
    <meta charset="UTF-8">
    <title>Chọn Chỗ Ngồi - Đặt Vé Tàu</title>
    @* <link rel="stylesheet" href="~/css/SeatSelection.css"> *@
</head>
<body>
    <h2>Danh Sách Tàu và Ghế</h2>

    <div class="train-list">
        @foreach (var train in Model)
        {
            <div class="train-item">
                <!-- Thông tin tàu -->
                <h3>@train.Name</h3>
                <p>Trạng thái: @(train.IsActive == true ? "Hoạt động" : "Không hoạt động")</p>

                <!-- Danh sách ghế của từng tàu -->
                <div class="seats-section">
                    <h4>Danh sách ghế</h4>
                    <div class="seats-grid">
                        @foreach (var seat in train.Seats)
                        {
                            <div class="seat @(seat.Status.ToLower())"
                                 data-seat-id="@seat.SeatId"
                                 data-status="@seat.Status.ToLower()"
                                 data-price="@seat.Price">
                                Ghế @seat.SeatId
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Thông tin ghế đã chọn -->
    <div class="booking-summary">
        <h3>Thông tin đặt vé</h3>
        <p>Ghế đã chọn: <span id="selectedSeatsDisplay">Chưa chọn ghế</span></p>
        <p>Tổng tiền: <span id="totalPrice">0 VND</span></p>
        <button id="proceedToBooking" class="proceed-btn">Tiếp Tục</button>
    </div>

@*     <script src="~/js/SeatSelection.js"></script> *@
</body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const seats = document.querySelectorAll('.seat');
        const selectedSeatsDisplay = document.getElementById('selectedSeatsDisplay');
        const totalPriceDisplay = document.getElementById('totalPrice');
        let selectedSeats = [];
        let totalPrice = 0;

        seats.forEach(seat => {
            const status = seat.dataset.status;

            // Chỉ cho phép chọn ghế trống
            if (status === 'available') {
                seat.addEventListener('click', () => {
                    const seatId = seat.dataset.seatId;
                    const price = parseFloat(seat.dataset.price);

                    // Kiểm tra xem ghế đã được chọn hay chưa
                    if (seat.classList.contains('selected')) {
                        // Hủy chọn ghế
                        seat.classList.remove('selected');
                        selectedSeats = selectedSeats.filter(id => id !== seatId);
                        totalPrice -= price;
                    } else {
                        // Chọn ghế
                        seat.classList.add('selected');
                        selectedSeats.push(seatId);
                        totalPrice += price;
                    }

                    // Cập nhật hiển thị ghế đã chọn và tổng tiền
                    selectedSeatsDisplay.textContent = selectedSeats.length > 0 ? selectedSeats.join(', ') : 'Chưa chọn ghế';
                    totalPriceDisplay.textContent = `${totalPrice.toLocaleString()} VND`;
                });
            }
        });
    });

</script>